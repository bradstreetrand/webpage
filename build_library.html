<?php
// Initialize the session
session_start();
 
// If session variable is not set it will redirect to login page
if(!isset($_SESSION['username']) || empty($_SESSION['username'])){
  header("location: login.php");
  exit;
}

?>

<html class="no-js" lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bradstreet Rand</title>
    <link rel="stylesheet" href="css/foundation.css">
    <link rel="stylesheet" href="css/app.css">
  </head>

<body>

<div class="grid-x callout ">
	<div class="large-4 cell">
		<p>Enter ISBN number</p>
		<input type="text" name="isbn" id="isbnInput" />
		<input type="button" name="isbnSearch" onclick="isbnSearchGB('ISBN:' + document.getElementById('isbnInput').value)" value="Search by ISBN"/>
	</div>
	<div class="large-4 cell">
		<p>Enter Author & Title</p>
		<form>
			Author: <input type="text" name="authorInput" id="authorInput">
			Title: <input type="text" name="titleInput" id="titleInput">
		</form>
		<input type="button" name="authorSearch" onclick="authorTitleSearchGB('inauthor:' + document.getElementById('authorInput').value + '&intitle' + document.getElementById('titleInput').value )" value="Search by Author & Title"/>
	</div>
</div>
<div id="searchResults0">
	<p>Results will appear here.</p>
</div>
<div id="searchResults1"></div>
<div id="searchResults2"></div>
<div id="test"></div>

	<script type="text/javascript">
		"https://www.googleapis.com/books/v1/volumes?q="

		function isbnSearchGB(url) {
			var xhttp = new XMLHttpRequest();
			xhttp.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200) {
					var obj = JSON.parse(this.responseText)
					var info = obj.items[0]["volumeInfo"]
					displayTest(obj);
				}
			}
			xhttp.open("GET", "https://www.googleapis.com/books/v1/volumes?q=" + url + '&maxResults=3', true);
			xhttp.send();
		}
		function authorTitleSearchGB(url) {
			var xhttp = new XMLHttpRequest();
			xhttp.onreadystatechange = function() {
				if (this.readyState == 4 && this.status == 200) {
					var obj = JSON.parse(this.responseText)
					var info = obj.items[0]["volumeInfo"]
					displayTest(obj);
				}
			}
			xhttp.open("GET", "https://www.googleapis.com/books/v1/volumes?q=" + url + '&maxResults=3' , true);
			xhttp.send();
		}
		function displayTest(obj){
			for (var i = 0; i < 3; i++) {
				if (typeof obj.items[i]["volumeInfo"]["subTitle"] != 'undefined' ) {
				var subtitle = obj.items[i]["volumeInfo"]["subTitle"] + " </br>";
				} else {var subtitle ="";}
				
				document.getElementById("searchResults" + i.toString()).innerHTML = 
				obj.items[i]["volumeInfo"]["title"] + " </br>" +
				subtitle +
				obj.items[i]["volumeInfo"]["authors"][i] + " </br>" + 
				obj.items[i]["volumeInfo"]["description"] + "</br></br>"
				;				
			}
		}
	</script>
    <script src="js/vendor/jquery.js"></script>
    <script src="js/vendor/what-input.js"></script>
    <script src="js/vendor/foundation.js"></script>
    <script src="js/app.js"></script>
  </body>
</html>